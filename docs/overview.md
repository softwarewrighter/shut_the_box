# Project Overview: Shut the Box

**Last Updated:** 2025-11-14

## Purpose

Shut the Box is a 3D web-based implementation of the classic dice game, built as a showcase of modern web technologies combining Rust/WebAssembly with Three.js 3D graphics. The project demonstrates:

- High-performance game logic using Rust compiled to WebAssembly
- Professional 3D rendering with Three.js and WebGL
- Seamless integration between Rust backend and JavaScript frontend
- Modern web development best practices with comprehensive testing

The game provides an engaging, visually appealing experience while maintaining the traditional rules and strategy of the classic "Shut the Box" dice game.

## Current Status

### Completed Features

**Core Game Mechanics:**
- Full implementation of traditional Shut the Box rules
- Automatic single-die mode when only tiles 1-6 remain up
- Recursive move validation for complex tile combinations
- Proper game state management (new game, in-progress, game over)
- Score calculation and win condition detection (perfect score = 0)

**3D Graphics & UI:**
- Isometric view with Three.js rendering engine
- Realistic dice with authentic pip arrangements (opposite faces sum to 7)
- Smooth animations for dice rolling and tile flipping
- Visual feedback with color-coded tiles
- Responsive button state management
- Splash screen with 3D jellybean-style buttons and instructions dialog

**Technical Infrastructure:**
- Rust/WASM backend with wasm-bindgen bindings
- Build automation with `build.sh` and `run.sh` scripts
- Comprehensive test coverage:
  - 11 Rust unit tests covering game logic and edge cases
  - 3 WASM browser tests for WebAssembly functionality
- WASM test environment detection to prevent hanging tests
- Browser-compatible randomness using getrandom with "js" feature

**Development Tools:**
- Automated build process with wasm-pack
- Development server integration with basic-http-server
- Clean project structure with documentation

### Known Limitations

- Single-player only (no multiplayer or scoring history)
- No persistent state (scores reset on page reload)
- Desktop-focused UI (mobile responsiveness not optimized)
- Limited game modes (no variants or difficulty levels)

## Architecture Summary

**Technology Stack:**
- **Backend:** Rust 2021 edition, compiled to WebAssembly
- **Build Tool:** wasm-pack for WASM compilation
- **Frontend:** Vanilla JavaScript with Three.js for 3D rendering
- **Web Interface:** HTML5/CSS3 with modern responsive design

**Key Components:**
- `src/lib.rs` - Core game logic (Game struct) with WASM bindings
- `www/main.js` - Three.js 3D scene management and UI interaction
- `www/index.html` - Web interface structure and controls
- Generated WASM files in `www/` directory (auto-generated by build)

**Data Flow:**
1. User interaction in browser (JavaScript)
2. Call to Rust game logic via WASM bindings
3. Game state update in Rust
4. Return result to JavaScript
5. Update 3D visualization and UI

## Possible Next Steps

### Enhancements (Priority: High)
1. **Score Persistence:** Add localStorage or backend API to track high scores and game history
2. **Mobile Optimization:** Improve touch controls and responsive layout for mobile devices
3. **Sound Effects:** Add audio feedback for dice rolls, tile flips, and game events
4. **Multiplayer Mode:** Implement turn-based multiplayer with score comparison
5. **Leaderboard:** Create global or local leaderboard system

### Game Features (Priority: Medium)
6. **Game Variants:** Add traditional variants like "golf scoring" or "timed mode"
7. **Undo Feature:** Allow players to undo the last move
8. **Hint System:** Suggest valid tile combinations for beginners
9. **Statistics Dashboard:** Track games played, win rate, average score
10. **Difficulty Levels:** Introduce variations in scoring or rules

### Technical Improvements (Priority: Low-Medium)
11. **Progressive Web App:** Add service worker for offline play and installability
12. **Performance Monitoring:** Add telemetry for render performance and load times
13. **Accessibility:** Improve keyboard navigation and screen reader support
14. **Visual Themes:** Allow users to customize board and dice appearance
15. **Animation Polish:** Add more sophisticated physics and particle effects

### Code Quality (Priority: Low)
16. **Refactoring:** Extract UI components for better maintainability
17. **Documentation:** Add inline code documentation and architecture diagrams
18. **CI/CD Pipeline:** Automated testing and deployment workflows
19. **Code Coverage:** Expand test coverage to include frontend JavaScript

## Build Commands

- **Build:** `./build.sh` - Compiles Rust to WASM
- **Run:** `./run.sh` - Starts server on port 4000 and opens browser
- **Test (Rust):** `cargo test` - Runs 11 unit tests
- **Test (WASM):** `wasm-pack test --chrome --headless` or `wasm-pack test --firefox --headless` - Runs 3 browser tests

## Recent Changes

Based on git history:
- Fixed WASM tests hanging by detecting test environment
- Added splash screen with 3D jellybean buttons and instructions dialog
- Fixed build.sh script to suggest run.sh instead of basic-http-server
- Updated documentation with comprehensive testing information
- Fixed WASM test compilation and added WASM-specific tests

## Success Metrics

The project successfully demonstrates:
- Clean separation between game logic (Rust) and presentation (JavaScript)
- Production-ready WASM integration with proper build tooling
- Professional 3D graphics with smooth animations
- Comprehensive testing at both unit and integration levels
- Clear documentation and development workflow

---

*This overview is maintained to provide project status at a glance for project management purposes.*
